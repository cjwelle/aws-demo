<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>AWS-Demo</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>AWS-Demo</h1>
<span id="author">Christopher Welle</span><br />
<span id="email"><code>&lt;<a href="mailto:cjwelle@gmail.com">cjwelle@gmail.com</a>&gt;</code></span><br />
<span id="revnumber">version 1.8,</span>
<span id="revdate">2017-02-06</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This repo is an example of using Ansible to launch AWS Cloudformation templates to build VPC&#8217;s and Packer to Build AMI&#8217;s along with cleaning up of the VPC after done.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_kitchen_server">Kitchen Server</h2>
<div class="sectionbody">
<div class="paragraph"><p>The kitchen server for this repo used  <a href="https://www.vagrantup.com/">Vagrant</a> with <a href="https://github.com/dotless-de/vagrant-vbguest">Vagrant-vbguest plugin</a> and  <a href="https://www.virtualbox.org/">Virtual Box</a> installed on the host machine.</p></div>
<div class="sect2">
<h3 id="_start_up_kitchen_server">Start up Kitchen Server</h3>
<div class="listingblock">
<div class="content">
<pre><code>vagrant up</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This could take up to 30 mins to start. This will launch a vagrant box and run the kitchen.yml file against the vagrant box.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_log_into_the_vagrant_box">Log into the Vagrant box</h3>
<div class="listingblock">
<div class="content">
<pre><code>vagrant ssh</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_verify_that_your_aws_credentials_are_passed_through">Verify that your AWS credentials are passed through.</h3>
<div class="listingblock">
<div class="content">
<pre><code>aws s3 ls</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_change_directory_to_workfolder_before_running_the_commands_below">Change directory to workfolder before running the commands below.</h3>
<div class="listingblock">
<div class="content">
<pre><code>cd ~/workfolder</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtual_private_cloud">Virtual Private Cloud</h2>
<div class="sectionbody">
<div class="paragraph"><p>The VPC&#8217;s are required 1st to build the AMI&#8217;s in. This section will build two VPC&#8217;s that are peered together. The template is found under files/cfs/Demo_2VPC_CFS.json. This file is uploaded to a S3 Bucket that is accessible via http url.</p></div>
<div class="sect2">
<h3 id="_upload_cfs_file_to_s3_bucket_and_make_it_available_via_http">Upload CFS File to S3 bucket and make it available via http</h3>
<div class="paragraph"><p>This command uploads the CFS to a S3 bucket in your account. Change the s3:// address to a bucket in your account.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>aws s3 cp files/cfs/Demo_2VPC_CFS.json s3://&lt;your_s3_bucket&gt; --grants read=uri=http://acs.amazonaws.com/groups/global/AllUsers</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_build_vpc">Build VPC</h3>
<div class="paragraph"><p>This command will use Ansible to launch the cloudformation template into AWS. You will need to adjust the URL to the region your S3 bucket is in and the name of the s3 bucket. You can test the URL out by entering the address in a Web Browser.</p></div>
<div class="paragraph"><p>While this command runs, you can view the status in the AWS Console, under Cloudformation, Select the stack that is CREATE_IN_PROGRESS and click on Events tab n the bottom window.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>time ansible-playbook services/vpc/infra_create.yml \
  --extra-vars "region=us-west-2 \
                infra_stack_name=Demo-Test-Infra \
                template=https://s3-&lt;region_of_s3_bucket&gt;.amazonaws.com/&lt;your_s3_bucket&gt;/Demo_2VPC_CFS.json"</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">COMMAND OPTIONS</div>
<div class="literalblock">
<div class="content">
<pre><code>region = AWS region the VPC that packer will build the AMI in. NOTE: The file needs to reference the AZ your account has access to in that region. Not all AWS accounts have access to the same AZ's.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>infra_stack_name = The Name of the cloudformation stack to launch. Going forward this name will be used to reference when to pull Outputs from the cloudformation stack when launching services or building AMI's.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>template = URL to the cloudformation template files. This needs to be a S3 bucket URL as many of the cloudformation templates over a character size will not be able to be referenced via file.</code></pre>
</div></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Estimated time to run</div>
<div class="literalblock">
<div class="content">
<pre><code>real 1m33.651s
user 0m2.323s
sys 0m17.266s</code></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_base_ami">Create Base AMI</h2>
<div class="sectionbody">
<div class="paragraph"><p>Base AMI, is the common base OS image that all services are built off of. Any security, common user, or common package that is used throughout the cloud stack, is managed and applied during this process. (e.g. This AMI is use to build other services, launch Jumpboxes, or any other EC2 instances.)</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Change the ami to the ubuntu 14.04 HVM version for your region.
TIP: Change the s3_log_bucket variable to a S3 bucket that you wish your syslogs to go to.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><code>time ansible-playbook services/default_base/build_base_ami.yml \
  --extra-vars "region=us-west-2 \
                source_ami=ami-5e63d13e \
                s3_log_bucket=cc-syslogs \
                infra_stack_name=Demo-Test-Infra"</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">COMMAND OPTIONS</div>
<div class="literalblock">
<div class="content">
<pre><code>region = AWS region the VPC that packer will build the AMI in.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>source_ami = AMI that is already created in AWS. e.g. Ubuntu 14.04 HVM created AMI from Canonical.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>s3_log_bucket = The S3 bucket to ship all logs from /var/logs to.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>infra_stack_name = The Name of the cloudformation stack to launch. Going forward this name will be used to reference when to pull Outputs from the cloudformation stack when launching services or building AMI's.</code></pre>
</div></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Estimated time to run</div>
<div class="literalblock">
<div class="content">
<pre><code>real 13m29.292s
user 0m13.888s
sys 2m33.339s</code></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copy_ami_8217_s_to_other_regions">Copy AMI&#8217;s to other regions</h2>
<div class="sectionbody">
<div class="paragraph"><p>This command will copy the AMI to different Regions. Change the command options to match the AMI you wish to copy.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>time ansible-playbook services/rep_ami/rep-ami.yml \
             --extra-vars "region=us-west-2 \
               owner_id=0000000000012 \
               ami_name=default_base-ops-1486380934 \
               src_dest=us-west-1,us-east-1,us-east-2"</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">COMMAND OPTIONS</div>
<div class="literalblock">
<div class="content">
<pre><code>region = AWS region that the AMI is currently located in.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>owner_id = AWS Account number that the AMI is owned by.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>ami_name = AMI Name. NOTE: Not the AMI Tag name, the ami name.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>src_dest = list of AWS regions to copy the AMI to.</code></pre>
</div></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Estimated time to run</div>
<div class="literalblock">
<div class="content">
<pre><code>Varies based on number of regions set in the src_dest.</code></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_destroy_vpc">Destroy VPC</h2>
<div class="sectionbody">
<div class="paragraph"><p>Cleans up the VPC build. If there are any servers running inside the VPC or anything changed manually to the VPC&#8217;s or networking that relate to the VPC&#8217;s, this will fail until those items are cleaned up or removed. You will need to adjust the URL to the region your S3 bucket is in and the name of the s3 bucket. You can test the URL out by entering the address in a Web Browser.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>time ansible-playbook services/vpc/infra_destroy.yml \
              --extra-vars "region=us-west-2 \
                infra_stack_name=Demo-Test-Infra \
                template=https://s3-&lt;region_of_s3_bucket&gt;.amazonaws.com/&lt;your_s3_bucket&gt;/Demo_2VPC_CFS.json"</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">COMMAND OPTIONS</div>
<div class="literalblock">
<div class="content">
<pre><code>region = AWS region the VPC that packer will build the AMI in.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>infra_stack_name = The Name of the cloudformation stack to destroy.</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>template = URL to the cloudformation template files. This needs to be a S3 bucket URL as many of the cloudformation templates over a character size will not be able to be referenced via file.</code></pre>
</div></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Estimated time to run</div>
<div class="literalblock">
<div class="content">
<pre><code>real   2m46.601s
user   0m35.046s
sys    0m5.547s</code></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.8<br />
Last updated 2017-02-06 12:07:46 UTC
</div>
</div>
</body>
</html>
